pattern = "\\.",
replacement = "\\?")
knitr::opts_chunk$set(warning=FALSE, message=FALSE, results='markup',cache=FALSE)
library(tidyverse)    # for working with data
library(measurements) # for unit conversions
library(deming)       # for orthogonal regression
library(epiR)         # for concordance correlation coefficient
jvPalette <- c("#330099","#CC0066","#FF6633",
"#0099CC", "#FF9900","#CC6633",
"#FF3366", "#33CC99", "#33999")
Tac_raw<-read_csv("/Users/johnvolckens/Documents/Research/R/UPAS/Tac1v2.csv")
Tac2<-dplyr::select(Tac_raw,-(UPAS:Umg), -(X27:X29)) %>%
mutate("type" = "SKC", Tfilter = as.numeric(Tfilter), PostCal = as.numeric(PostCal)) %>%
rename(date = Date, start_hms = Tstart, pumpID = Tpump, filterID = Tfilter,
duration = Tmin, volume = Tvol, mass = Tmg)
#reorder columns
Tac2<-Tac2[c(1,19,2:18)]
Tac3<-dplyr::select(Tac_raw, -(Tpump:PostCal), -(X27:X29)) %>%
mutate("type" = "UPAS") %>%
rename(start_hms = Ustart, UPASID = UPAS, cycloneID = Ucyc, cartridgeID = Ucart, filterID = Ufilter, duration = Umin, volume = Uvol, mass = Umg)
#reorder columns
Tac3<-Tac3[c(1,18,2:17)]
#join Tac dfs together
Tac_df <- bind_rows(Tac2, Tac3) %>%
select(-(Name))
#clean up
rm(Tac2, Tac3)
quartz_raw<-read_csv("/Users/johnvolckens/Documents/Research/R/UPAS/quartz_raw.csv")
quartz <- dplyr::select(quartz_raw, LabID:Result) %>%
rename(filterID = 'CSU SampleID', si_mass = Result, quartz_flag = DQF)
#note on quartz flags: () <- Analyte detected below LOQ of 13 ug;
#                       = <- Analyte detected above LOQ;
#                       < <- Analyte detected below LOD of 4 ug;
quartz_LOD <- 4
quartz_LOQ <- 13
#join quartz data to PM mass data
Tac_df <- dplyr::left_join(Tac_df, quartz, by = "filterID")
#create concentration metrics; units of
Tac_df <- dplyr::mutate(Tac_df,
mass_conc = mass/volume*1e6,
si_conc = si_mass/volume*1e3)
#QC procedures for respirable dust (mass)
Tac_QC <- dplyr::filter(Tac_df,
mass >= 0.033,
mass <= 0.650,
volume >= 700,
duration <= 800) %>%
group_by(type)
#Create export table for Karl Braun
Tac_QC_SKC <- ungroup(Tac_QC) %>%
dplyr::filter(type == "SKC") %>%
dplyr::select(-type,-pumpID,-Cal,-(Job1:Job3),-(Date:LabID), -quartz_flag) %>%
dplyr::rename(duration_min = duration,
volume_L = volume,
mass_mg = mass,
"PreCal_Lmin-1" = PreCal,
"PostCal_Lmin-1" = PostCal,
"si_mass_ug" = si_mass,
"si_conc_ugm-3" = si_conc,
"mass_conc_ugm-3" = mass_conc) %>%
dplyr::select(1:6,8:12,7,14,13,15) %>%
dplyr::left_join(select(Tac_raw, Name, SampleID), by = "SampleID") %>%
dplyr::select(1:8,16,9:15)
#Export file as csv
write.csv(Tac_QC_SKC, file = "/Users/johnvolckens/Documents/Research/R/UPAS/Taconite_SKC_QC.csv")
Tac_df %>%
select(type, mass, SampleID) %>%
filter(mass < 0.033) %>%
group_by(type) %>%
tally(name = "Samples below LOD")
Tac_df %>%
select(type, mass, SampleID) %>%
filter(mass > 0.650) %>%
group_by(type) %>%
tally(name = "Samples above mass limit")
Tac_df %>%
select(type, duration, SampleID) %>%
filter(duration >= 800) %>%
group_by(type) %>%
tally(name = "Samples below duration min")
Tac_df %>%
select(type, volume, SampleID) %>%
filter(volume < 700) %>%
group_by(type) %>%
tally(name = "Samples below run limit")
# Summarize concentrations by job category listed
jobs <- Tac_QC %>%
dplyr::filter(type == "SKC")       %>%
dplyr::select(-(Date:cartridgeID))
jobs_type <- jobs %>%
dplyr::filter_at(vars(starts_with("job")), any_vars(. == "crush")) %>%
dplyr::mutate(job_type = 'Crusher') %>%
dplyr::bind_rows(jobs %>%
dplyr::filter_at(vars(starts_with("job")), any_vars(. == "maint")) %>%
dplyr::mutate(job_type = 'Maintenance'))
#create a df that includes values below LOD with substituted values
jobs_with_LOD <- Tac_df %>%
dplyr::filter(mass <= 0.650,
volume >= 700,
duration <= 800,
duration >= 420) %>%
dplyr::mutate(mass_wLOD = if_else(mass < 0.033, 0.033/sqrt(2), mass),
conc_wLOD = mass_wLOD/volume*1e6)
jobs <- Tac_QC %>%
dplyr::filter(type == "SKC")       %>%
dplyr::select(-(Date:cartridgeID))
jobs_crush <- jobs %>%
dplyr::filter_at(vars(starts_with("job")), any_vars(. == "crush")) %>%
dplyr::mutate(job_type = 'Crusher')
jobs_maint <- jobs %>%
dplyr::filter_at(vars(starts_with("job")), any_vars(. == "maint")) %>%
dplyr::mutate(job_type = 'Maintenance')
jobs_loader <- jobs %>%
dplyr::filter_at(vars(starts_with("job")), any_vars(. == "loader")) %>%
dplyr::mutate(job_type = 'Loader')
jobs_driver <- jobs %>%
dplyr::filter_at(vars(starts_with("job")), any_vars(. == "driver")) %>%
dplyr::mutate(job_type = 'Driver')
jobs_welder <- jobs %>%
dplyr::filter_at(vars(starts_with("job")), any_vars(. == "weld")) %>%
dplyr::mutate(job_type = 'Welder')
jobs_pellet <- jobs %>%
dplyr::filter_at(vars(starts_with("job")), any_vars(. == "pellet")) %>%
dplyr::mutate(job_type = 'Pellet')
jobs_balling <- jobs %>%
dplyr::filter_at(vars(starts_with("job")), any_vars(. == "balling")) %>%
dplyr::mutate(job_type = 'Balling')
jobs_cat <- bind_rows(jobs_crush, jobs_maint, jobs_loader, jobs_driver, jobs_welder, jobs_pellet, jobs_balling, id = NULL)
rm(jobs_crush, jobs_maint, jobs_loader, jobs_driver, jobs_welder, jobs_pellet, jobs_balling)
jobs_crush_LOD <- jobs_with_LOD %>%
dplyr::filter_at(vars(starts_with("job1")), any_vars(. == "crush")) %>%
dplyr::mutate(job_type = 'Crusher')
jobs_maint_LOD <- jobs_with_LOD %>%
dplyr::filter_at(vars(starts_with("job1")), any_vars(. == "maint")) %>%
dplyr::mutate(job_type = 'Maintenance')
jobs_loader_LOD <- jobs_with_LOD %>%
dplyr::filter_at(vars(starts_with("job1")), any_vars(. == "loader")) %>%
dplyr::mutate(job_type = 'Loader')
jobs_driver_LOD <- jobs_with_LOD %>%
dplyr::filter_at(vars(starts_with("job1")), any_vars(. == "driver")) %>%
dplyr::mutate(job_type = 'Driver')
jobs_welder_LOD <- jobs_with_LOD %>%
dplyr::filter_at(vars(starts_with("job1")), any_vars(. == "weld")) %>%
dplyr::mutate(job_type = 'Welder')
jobs_pellet_LOD <- jobs_with_LOD %>%
dplyr::filter_at(vars(starts_with("job1")), any_vars(. == "pellet")) %>%
dplyr::mutate(job_type = 'Pellet')
jobs_balling_LOD <- jobs_with_LOD %>%
dplyr::filter_at(vars(starts_with("job1")), any_vars(. == "balling")) %>%
dplyr::mutate(job_type = 'Balling')
jobs_ball_pell_LOD <- dplyr::bind_rows(jobs_balling_LOD, jobs_pellet_LOD) %>%
mutate(job_type = 'Balling/Pelleting')
jobs_main_weld_LOD <- dplyr::bind_rows(jobs_maint_LOD, jobs_welder_LOD) %>%
mutate(job_type = 'Maintenance')
jobs_driv_load_LOD <- dplyr::bind_rows(jobs_driver_LOD, jobs_loader_LOD) %>%
mutate(job_type = 'Driver/Loader')
jobs_ball_pell_crush_LOD <- dplyr::bind_rows(jobs_balling_LOD, jobs_pellet_LOD, jobs_crush_LOD) %>%
mutate(job_type = 'Ball/Pellet/Crush')
jobs_cat_LOD <- bind_rows(jobs_ball_pell_crush_LOD,
jobs_main_weld_LOD,
jobs_driv_load_LOD,
id = NULL) %>%
arrange(SampleID, type)
rm(jobs_crush_LOD,
jobs_maint_LOD,
jobs_loader_LOD,
jobs_driver_LOD,
jobs_welder_LOD,
jobs_pellet_LOD,
jobs_balling_LOD,
jobs_ball_pell_LOD,
jobs_main_weld_LOD,
jobs_driv_load_LOD)
ggplot(filter(Tac_df, type == "SKC"), aes(si_conc)) +
geom_histogram(boundary = 0,
fill = "cyan4",
color = "white",
linetype = 1,
size = 1,
breaks = c(0,2,10,20,30,40,50)) +
theme_bw() +
geom_vline(xintercept = 2, linetype = 2) +
labs(y = "Counts (number of full-shift samples)",
x = expression(paste("Respirable Silica Concentration ", mu, g/m^3))) +
scale_y_continuous(limits = c(0,17), breaks = c(0,5,10,15), minor_breaks = seq(1,17,1))
#ggsave("RCS_Taconite_SKC.png", device = png(), dpi = 300)
ggplot(filter(Tac_QC, type == "SKC"), aes(si_conc)) +
geom_histogram(bins = 5,
boundary = 0,
fill = "skyblue",
color = "white",
linetype = 1,
size = 1,
breaks = c(0,10,20,30,40,50)) +
theme_bw() +
labs(y = "Counts (# of Full-shift Samples)",
x = expression(paste("Respirable Silica Concentration (", mu, g/m^3, ")"))) +
scale_y_continuous(limits = c(0,25),
breaks = c(0,5,10,15,20),
minor_breaks = seq(1,25,1))
#ggsave("RCS_Taconite_SKC.png", device = png(), dpi = 300)
ggplot(filter(Tac_QC, type == "SKC"), aes(mass_conc)) +
geom_histogram(bins = 6,
boundary = 0,
fill = "seagreen",
color = "white",
linetype = 1,
size = 1,
breaks = c(0,100,200,300,400,500,600)) +
theme_bw() +
#scale_x_log10() +
labs(y = "Counts (number of full-shift samples)",
x = expression(paste("Respirable Dust Concentration (", mu, g/m^3, ")"))) +
scale_x_continuous(breaks = c(0,100,200,300,400,500,600), minor_breaks = seq(0,600,50))
#ggsave("Resp_Dust_Taconite_SKC.png", device = png(), dpi = 300)
ggplot(jobs_cat, aes(job_type, si_conc)) +
geom_boxplot(fill = "skyblue") +
geom_jitter(width = 0.1) +
labs(y = expression(paste("Respirable Silica Conc (", mu, g/m^3,")")),
x = "Job Category") +
theme_bw()
ggplot(jobs_cat, aes(job_type, mass_conc)) +
geom_boxplot(fill = "seagreen") +
geom_jitter(width = 0.1) +
labs(y = expression(paste("Respirable Mass Conc (", mu, g/m^3,")")),
x = "Job Category") +
theme_bw()
#ggsave("Resp_Dust_Taconite_SKC_byJob.png", device = png(), dpi = 300)
supp.names <- c("NOISH 0600", "UPAS")
names(supp.names) <- c("SKC", "UPAS")
ggplot(jobs_cat_LOD, aes(x=job_type, y=conc_wLOD)) +
geom_boxplot(fill = "orange",
outlier.shape = NA) +
geom_jitter(width = 0.2,
height = 0.2,
alpha = 0.35) +
labs(y = expression(paste("Respirable Mass Conc (", mu, g/m^3,")")),
x = "Job Category") +
theme_bw() +
facet_wrap(vars(type),
labeller = labeller(type = supp.names))
ggsave("Resp_Dust_Taconite_byJob_combined.png", device = png(), dpi = 300)
#need to address duplicates and NAs in Job1
Tac_Scatt <- Tac_QC %>%
dplyr::select(SampleID, type, mass_conc, Job1, Job2) %>%
pivot_wider(names_from = type,
values_from = mass_conc) %>%
dplyr::rename(SKC_conc = SKC, UPAS_conc = UPAS) %>%
dplyr::filter(!is.na(UPAS_conc), !is.na(SKC_conc)) %>%
dplyr::mutate(jobs_cat = case_when(
str_detect(Job1, "maint") ~ "Maintenance",
str_detect(Job1, "shop") ~ "Maintenance",
str_detect(Job1, "load") ~ "Driver/Loader",
str_detect(Job1, "drive") ~ "Driver/Loader",
str_detect(Job1, "weld") ~ "Driver/Loader",
str_detect(Job1, "crush") ~ "Ball/Pellet/Crush",
str_detect(Job1, "belt") ~ "Ball/Pellet/Crush",
str_detect(Job1, "pellet") ~ "Ball/Pellet/Crush",
str_detect(Job1, "ball") ~ "Ball/Pellet/Crush",
str_detect(Job1, "filter") ~ "Ball/Pellet/Crush",
str_detect(Job2, "conc") ~ "Ball/Pellet/Crush",
str_detect(Job2, "belt") ~ "Ball/Pellet/Crush",
str_detect(Job1, "mgmt") ~ "Other",
is.na(Job1) ~ "Other"
))
#pearson correlation
R2 <- cor(x = Tac_Scatt$UPAS_conc, y = Tac_Scatt$SKC_conc, use = "pairwise.complete.obs")^2 %>% round(3)
#Lin's concordance
Lins <- epi.ccc(Tac_Scatt$SKC_conc, Tac_Scatt$UPAS_conc)
deming_mass <- deming(SKC_conc ~ UPAS_conc, Tac_Scatt, cv = TRUE)
p1<-ggplot(Tac_Scatt, aes(x = UPAS_conc, y = SKC_conc)) +
geom_point(color = "darkblue",
size = 2, fill = "darkblue",
alpha = 0.5) +
geom_abline(slope = 1,
intercept = 0,
color = "grey") +
geom_segment(x = min(Tac_Scatt$UPAS_conc, na.rm = TRUE),
y = (min(Tac_Scatt$UPAS_conc, na.rm = TRUE)
*deming_mass$coefficients[2]+deming_mass$coefficients[1]),
xend = max(Tac_Scatt$UPAS_conc, na.rm = TRUE),
yend = (max(Tac_Scatt$UPAS_conc, na.rm = TRUE)
*deming_mass$coefficients[2]+deming_mass$coefficients[1]),
linetype = 2) +
theme_bw() +
labs(y = expression(paste("NIOSH 0600 Respirable Dust (", mu, g/m^3,")")),
x = expression(paste("UPAS Respirable Dust (", mu, g/m^3,")"))) +
theme(aspect.ratio=1,
axis.title = element_text(size=12),
axis.text = element_text(size = 11)) +
scale_x_continuous(limits = c(0,615)) +
scale_y_continuous(limits = c(0,615)) +
annotate("text",
x = 0,
y = 575,
hjust = "left",
label = paste("NIOSH 0600 =",
round(deming_mass$coefficients[2], 2),
"x UPAS -",
abs(round(deming_mass$coefficients[1], 2)))) +
annotate("text",
x = 0,
y = 545,
hjust = "left",
label = as.expression(bquote(R^2 == .(R2)))) +
annotate("text",
x = 600,
y = 85,
hjust = "right",
label = expression(paste("1:1 Line \n Fit"))) +
geom_segment(x = 375, y = 126, xend = 475, yend = 126,
color = "grey",
weight = 1.5) +
geom_segment(x = 375, y = 87, xend = 475, yend = 87,
color = "black",
linetype = 2)
p1
ggsave("Resp_Dust_Taconite_SKCvsUPAS.png", device = png(), dpi = 300, height = 10, width = 10, units = "cm")
t.test(x = log(Tac_Scatt$UPAS_conc), y = log(Tac_Scatt$SKC_conc), paired = TRUE)
wilcox.test(x = log(Tac_Scatt$UPAS_conc), y = log(Tac_Scatt$SKC_conc), paired = TRUE)
mass_diff <- Tac_Scatt$UPAS_conc-Tac_Scatt$SKC_conc
mean_diff <- round(mean(mass_diff, na.rm = TRUE), 1)
p2<-ggplot(Tac_Scatt, aes(x = (SKC_conc + UPAS_conc)/2, y = (UPAS_conc - SKC_conc))) +
geom_point(aes(color = jobs_cat, type = jobs_cat),
size = 2,
alpha = 0.5) +
geom_abline(slope = 0.25,
intercept = 0,
color = "grey") +
geom_abline(slope = -0.25,
intercept = 0,
color = "grey") +
labs(x = expression(paste("Average (", mu, g/m^3, "): ", frac(UPAS+"Ref", 2))),
y = expression(paste("Difference (", mu, g/m^3, "): UPAS - Ref"))) +
geom_hline(yintercept = mean(mass_diff, na.rm = TRUE),
size = 0.5) +
annotate("text", x = 290,
y = 17,
label = expression(paste("Mean diff: ",
-1.7 ,
mu, g/m^3)),
color = "black",
hjust = "left",
size=3) +
geom_hline(yintercept = mean(mass_diff, na.rm = TRUE) + 1.96*sd(mass_diff, na.rm = TRUE),
size = 0.5,
color = "orange",
linetype = 2) +
annotate("text", x = 385,
y = 117,
label = "+25% of average",
angle = 12,
color = "grey") +
annotate("text", x = 385,
y = -112,
label = "-25% of average",
angle = -11,
color = "grey") +
geom_hline(yintercept = mean(mass_diff, na.rm = TRUE) -1.96*sd(mass_diff, na.rm = TRUE),
size = 0.5,
color = "orange",
linetype = 2) +
annotate("text", x = 5,
y = 175,
label = "95% CI",
color = "orange",
hjust = "left") +
theme_bw() +
theme(aspect.ratio=1,
axis.title = element_text(size=10),
axis.text = element_text(size = 9))+
scale_y_continuous(breaks = seq(-300, 300, 100),
limits = c(-305, 305)) +
scale_x_continuous(breaks = seq(0, 500, 100),
limits = c(0, 500)) +
theme(axis.title.x = element_text(vjust=-0.5))
p2
ggsave("Resp_Dust_Taconite_Bland_Alt.png",
device = png(),
dpi = 300,
units = "cm")
#Read in the metals data
data_metals <- as_tibble(read_csv("/Users/johnvolckens/Documents/Research/R/UPAS/Tac_metals.csv", col_types = cols(.default = col_number())))
#find and remove duplicate entries
df_metals <- data_metals %>%
dplyr::filter(duplicated(data_metals$'Filter ID') == FALSE) %>%
dplyr::rename(filterID = "Filter ID")
#Jessica's code to melt the data
df_metals_long <- df_metals %>%
tidyr::gather(key = "element", value="ug_cm2", 2:22) %>%
dplyr::left_join(dplyr::select(Tac_df, filterID, volume), by=c("filterID")) %>%
dplyr::mutate(met_conc = ug_cm2*6.6/volume*1000) %>%
group_by(element)
summary<-summarise(df_metals_long, "mean" = mean(met_conc), "median" = median(met_conc), "sd" = sd(met_conc))
#JV's code to move the data back to wide format
df_metals <- df_metals_long %>%
tidyr::pivot_wider(names_from = element, values_from = c(met_conc, ug_cm2)) %>%
drop_na() %>%
dplyr::select(-volume)
#Combine with Tac_df and apply QA / QC filters
Tac_df_metals <- Tac_df %>%
dplyr::left_join(df_metals, -volume, by = "filterID") %>%
dplyr::select(-(ug_cm2_Mg:ug_cm2_Pb)) %>% # remove the ug_cm2 columns
dplyr::filter(              # apply QA/QC filters to sample volume and runtime
volume >= 700,
duration <= 800,
mass >= 0.033,
mass <= 0.65,)
#histogram of all metal species, both UPAS and SKC, no QA/QC filters
t <- (ggplot(df_metals_long, aes(met_conc)) + geom_histogram(bins = 20))
t +
facet_wrap(vars(element)) +
scale_x_log10() +
labs(x = expression(paste("PM Concentration (", mu, g/m^3,")")))
#Boxplot of all metal species, both UPAS and SKC, no QA/QC filters
ggplot(df_metals_long, aes(element, met_conc), legend = element) +
geom_boxplot() +
scale_y_log10() +
labs(x = expression(paste("PM Concentration (", mu, g/m^3,")")))
tp_SKC_vols <- Tac_df_metals %>%
dplyr::filter(type == "SKC") %>%
dplyr::select(volume, SampleID, duration)
sample_vols <- Tac_df_metals %>%
dplyr::filter(type == "UPAS") %>%
dplyr::select(volume, SampleID, duration) %>%
dplyr::left_join(tp_SKC_vols, by = "SampleID") %>%
dplyr::rename(UPAS_vol = "volume.x",
SKC_vol = "volume.y",
UPAS_dur = "duration.x",
SKC_dur = "duration.y") %>%
dplyr::mutate(vols_ratio = UPAS_vol/SKC_vol, duration_ratio = UPAS_dur/SKC_dur)
ggplot(sample_vols) +
geom_dotplot(aes(vols_ratio),
binwidth = .01,
dotsize = 2,
fill = "navyblue",
alpha = 0.5) +
geom_dotplot(aes(duration_ratio),
binwidth = .01,
dotsize = 2,
fill = "cyan",
alpha = 0.5)
sample_vols <- sample_vols %>%
dplyr::mutate(v_flag = if_else(vols_ratio<0.85,
if_else(vols_ratio>0.75, TRUE, FALSE), FALSE)) %>%
dplyr::mutate(d_flag = if_else(duration_ratio<1.1,
if_else(duration_ratio>0.9, TRUE, FALSE), FALSE))
#Connect UPAS and SKC metals data by row
Tac_metals_UPAS <- Tac_df_metals %>%
dplyr::filter(type == "UPAS") %>%
dplyr::select(1,2,5,9,19:22,26:48)
#Rename metals column names in Tac_metals_UPAS
names <- str_split(colnames(Tac_metals_UPAS[match("met_conc_Mg", names(Tac_metals_UPAS)):match("met_conc_Pb", names(Tac_metals_UPAS))]),
"met_conc_", n = 2, simplify = TRUE)
names <- names[,2]
Tac_metals_UPAS <- Tac_metals_UPAS %>%
dplyr::rename_at(vars(met_conc_Mg:met_conc_Pb), ~names)
#Prep and rename SKC data for joining
Tac_metals_SKC <- Tac_df_metals %>%
dplyr::filter(type == "SKC") %>%
dplyr::rename_at(vars(met_conc_Mg:met_conc_Pb), ~names) %>%
dplyr::select(-(date:cartridgeID), -si_mass, -si_conc) %>%
dplyr::rename(SKC_mass_c = mass_conc)
Tac_metals_reg <- Tac_metals_SKC %>%
dplyr::left_join(Tac_metals_UPAS, by = "SampleID") %>%
drop_na(contains(".x"), contains(".y")) %>%
dplyr::left_join(sample_vols, by = "SampleID") %>%
dplyr::filter(v_flag == TRUE, d_flag == TRUE)
deming_Fe <- deming(Fe.y ~ Fe.x, Tac_metals_reg,
cv = TRUE) #assume constant CV across data
weights <- (1/((Tac_metals_reg$Fe.x+Tac_metals_reg$Fe.y)/2))
deming_Fe_weighted <- deming(Fe.y ~ Fe.x, Tac_metals_reg,
weights = weights)
ln_deming_Fe <- deming(log(Fe.y) ~ log(Fe.x), Tac_metals_reg,
cv = TRUE) #assume constant CV across data
lm_Fe <- lm(Fe.y ~ Fe.x, Tac_metals_reg)
ggplot(Tac_metals_reg, aes(Fe.x, Fe.y)) +
#coord_trans(x = "log", y = "log", limx = c(8,225), limy = c(8,225)) +
geom_point(color = "darkblue", size = 2, fill = "darkblue", alpha = 0.5) +
geom_abline(slope = 1,
intercept = 0,
color = "grey") +
geom_segment(x = 3,
y = (deming_Fe$coefficients[1]+3*deming_Fe$coefficients[2]),
xend = max(Tac_metals_reg$Fe.x, na.rm = TRUE),
yend = (max(Tac_metals_reg$Fe.x, na.rm = TRUE)*deming_Fe$coefficients[2]
+deming_Fe$coefficients[1]),
linetype = 2)+
theme_bw() +
labs(y = expression(paste("UPAS Elemental Fe (", mu, g/m^3,")")),
x = expression(paste("SKC Elemental Fe (", mu, g/m^3,")")),
title = "Iron") +
theme(aspect.ratio=1,
axis.title = element_text(size=12),
axis.text = element_text(size = 11))
#scale_x_log10(limits = c(1,225)) +
#scale_y_log10(limits = c(1,225))
ggsave("Resp_Iron_Taconite_SKCvsUPAS.png", device = png(), dpi = 300, height = 10, width = 10, units = "cm")
Fe_model <- Tac_metals_reg
Fe_fit <- lm(Fe.y ~ Fe.x, Tac_metals_reg)
Fe_model$predicted <- predict(Fe_fit)
Fe_model$residuals <- residuals(Fe_fit)
# From: https://drsimonj.svbtle.com/visualising-residuals
ggplot(Fe_model, aes(x = Fe.x, y = Fe.y)) +
geom_smooth(method = "lm", se = FALSE, color = "lightgrey") +
geom_segment(aes(xend = Fe.x, yend = predicted), alpha = .2) +
# > Color AND size adjustments made here...
geom_point(aes(color = abs(residuals), size = abs(residuals))) + # size also mapped
scale_color_continuous(low = "black", high = "red") +
guides(color = FALSE, size = FALSE) +  # Size legend also removed
geom_point(aes(y = predicted), shape = 1) +
theme_bw()
